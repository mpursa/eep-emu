/**
 * IMPORT MODULES
 */
import fs from 'fs';
import path from 'path';

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/**
 * ENTRY POINT.
 * Obtain target from arguments and start script.
 * Clean given or default "lib" directory by deleting rall content recursively.
 *
 * @returns {void}
 */
function main(): void {
	let targetArg: string = process.argv[2];
	let target: string =
		targetArg === undefined ? path.resolve('lib') : path.resolve('lib', targetArg);
	console.log(`Cleaning directory ${target}`);
	if (fs.existsSync(target)) {
		deleteDirRec(target);
	}
	return console.log(`Successfully cleaned ${target}`);
}

/**
 * Recursively delete target directory.
 *
 * @param {string} dirPath - Target directory.
 * @returns {void}
 */
function deleteDirRec(dirPath: string): void {
	if (fs.existsSync(dirPath) && fs.lstatSync(dirPath).isDirectory()) {
		fs.readdirSync(dirPath).forEach((file: string) => {
			let curPath: string = path.join(dirPath, file);
			if (fs.lstatSync(curPath).isDirectory()) {
				deleteDirRec(curPath);
			} else {
				fs.unlinkSync(curPath);
			}
		});
		fs.rmdirSync(dirPath);

		return console.log(`Content of "${dirPath}" deleted`);
	}
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
main(); ////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
